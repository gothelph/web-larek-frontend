# Проектная работа "Веб-ларек"

## Стек:

```
HTML, SCSS, TS, Webpack
```

## Сборка

```
npm run build
```

или

```
yarn build
```

---

# Архитектура проекта

## **1. Описание данных: интерфейсы и классы с хранением данных**

### **Интерфейсы:**

Определяют форму данных и методы, которыми эти данные управляются.

- **Товары**

  - `IProductItem`: представляет товар (id, title, image, description, category, price).

- **Корзина**

  - `IBasketItem`: элемент корзины (id, title, price).
  - `IBasketModel`: интерфейс корзины — методы для управления и коллекция `items`.

- **Заказ**

  - `IOrderInfo`: итоговые данные заказа — адрес, email, телефон, способ оплаты, список товаров, общая сумма.

- **API**

  - `IClientApi`: интерфейс клиентской части API для работы с товарами и заказами.
  - `IApiError`: структура ошибки от API.

- **Валидация**

  - `IValidatorSettings`: параметры валидации формы.
  - `IValidator`: интерфейс валидатора с методами `enableValidation()` и `clearValidation()`.

- **Типы карточек**

  - `CardViewType`: определяет тип визуального отображения карточки: `'catalog'`, `'preview'`, `'basket'`.

  - `CardItemType<T>`: определяет тип содержимого карточки в зависимости от её вида (`IProductItem` или `IBasketItem`).

  - `CardViewFactoryType<T>`: функция, генерирующая DOM-элемент карточки по шаблону и типу.

---

## **2. Модели данных: реализации интерфейсов, действия и назначение**

### **Классы:**

- **Basket (реализация `IBasketModel`)**

  - Хранит товары в `Map<string, IBasketItem>`.
  - Методы:
    - `addItem(item: IBasketItem)`: добавляет товар в корзину.
    - `removeItem(id: string)`: удаляет товар из корзины.
    - `clear()`: очищает корзину.
    - `getTotalPrice()`: рассчитывает сумму заказа.
  - Назначение: управляет состоянием корзины и предоставляет методы для её изменения.

- **ApiService (реализация `IClientApi`)**

  - Методы:
    - `getProductList()`: получает список товаров.
    - `getProductItem(id)`: получает один товар.
    - `processOrder(order)`: отправляет заказ.
  - Назначение: абстрагирует взаимодействие с сервером.

- **FormValidator (реализация `IValidator`)**

  - Использует `IValidatorSettings`.
  - Методы:
    - `enableValidation()`: навешивает слушатели событий.
    - `clearValidation(form)`: сбрасывает валидацию.
  - Назначение: управляет валидацией форм.

- **CardView <T extends CardViewType> (абстрактный класс)**

  - Универсальный класс отображения карточки.
  - Поля:
    - `element`: HTML-элемент карточки.
    - `prepareTemplate`: функция генерации шаблона (фабрика).
  - Конструктор принимает: шаблон, тип карточки, товар или элемент корзины, обработчик клика и события.
  - Используется для создания всех типов карточек.

---

## **3. Компоненты (визуальная часть)**

### **Карточки и списки товаров:**

- Все карточки наследуются от базового `CardView`:
  - `ProductView`: карточка товара в каталоге.
  - `DetailProductView`: подробная карточка товара.
  - `BasketItemView`: карточка элемента корзины.

> `CardView` автоматически связывает шаблон, тип карточки и данные, и возвращает готовый `HTMLElement`.

- `IMainPageView`: интерфейс главной страницы:
  - `productList`: список карточек.
  - `gallery`: блок с товарами.
  - `headerBasketButton`, `headerBasketCounter`: элементы шапки.
  - Методы: `renderProductList`, `fetchProductList`.

### **Корзина:**

- `IBasketItemView`: визуальное представление элемента корзины.
- `IBasketView`: интерфейс всей корзины с методами из `IBasketModel` + `onConfirm()` (подтверждение заказа).

### **Формы заказа:**

- `OrderInfoFormView`: шаг 1 — адрес и способ оплаты.
- `OrderInfoContactsFormView`: шаг 2 — email и телефон.
- Оба наследуются от абстрактного класса `Form<T>`:
  - Поля: `errors`- элемент с выводом ошибки формы, `submit`- кнопка отправки формы.
  - Методы: `render()`, `onInputChange()`.

### **Модальное окно:**

- `ModalView`: базовый класс модального окна.
  - Методы: `openModal()`, `closeModal()`, `render()`.
  - Поля: `element`, `closeButton`.

### **Финальный экран:**

- `ISuccessView`: объект с итоговой суммой после успешного оформления заказа (`total`).

---

## **4. Описание событий**

### **События, связанные с изменением данных (внутренние действия):**

- `addItem`: вызывается при добавлении товара в корзину.
- `removeItem`: удаляет товар из корзины.
- `clear`: очищает корзину после оформления заказа.
- `getTotalPrice`: пересчитывает общую сумму.
- `processOrder`: отправляет заказ на сервер.
- `getProductItem`, `getProductList`: получают данные товаров.

### **События – действия пользователя (UI события):**

- Клик по карточке товара (`ProductView.onClick`) → переход в подробный просмотр.
- Клик по "Добавить в корзину" (`DetailProductView`) → вызывает `IBasketModel.addItem`.
- Клик по "Удалить" в корзине (`BasketItemView`) → вызывает `IBasketModel.removeItem`.
- Клик по "Оформить заказ" → запускает цепочку `OrderInfoFormView → OrderInfoContactsFormView → processOrder`.
- Ввод данных в форме → вызывает `Form.onInputChange()` и запускает валидацию.
- Клик по кнопке подтверждения заказа → отправка данных и отображение `SuccessView`.

---

## Структура директорий

- `src/` — исходные файлы
- `src/components/` — содержит компоненты приложения
- `src/components/base/` — базовые компоненты
- `src/images/` — графические ресурсы проекта
- `src/pages/` — страницы приложения
- `src/public/` — статические ресурсы
- `src/scss/` — стили проекта
- `src/types/` — определения типов данных
- `src/utils/` — вспомогательные утилиты
- `src/vendor/` — сторонние библиотеки

## Важные файлы:

`- src/pages/index.html` — HTML-файл главной страницы
`- src/types/index.ts` — файл с типами
`- src/index.ts` — точка входа приложения
`- src/scss/styles.scss` — корневой файл стилей
`- src/utils/constants.ts` — файл с константами
`- src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
