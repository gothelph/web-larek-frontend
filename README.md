# Проектная работа "Веб-ларек"

## Стек:

```
HTML, SCSS, TS, Webpack
```

## Сборка

```
npm run build
```

или

```
yarn build
```

---

````markdown
# Проектная работа "Веб-ларек"

## Стек технологий:

- **TypeScript** - строгая типизация
- **SCSS** - стилизация
- **Webpack** - сборка проекта
- **HTML5** - разметка

## Сборка и запуск:

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run start

# Сборка production версии
npm run build
```
````

---

# Архитектура проекта

## **1. Структура данных и интерфейсы**

### **Основные интерфейсы:**

- **`IProductItem`** - товар в каталоге:

  ```typescript
  interface IProductItem {
  	id: string;
  	description: string;
  	image: string;
  	title: string;
  	category: string;
  	price: number | null;
  }
  ```

- **`IBasketItem`** - элемент корзины:

  ```typescript
  interface IBasketItem {
  	id: string;
  	title: string;
  	price: number;
  }
  ```

- **`IOrderInfo`** - данные заказа:

  ```typescript
  interface IOrderInfo {
  	payment: 'online' | 'cash';
  	address: string;
  	email: string;
  	phone: string;
  	total: number;
  	items: string[];
  }
  ```

- **`IClientApi`** - API для работы с сервером:
  ```typescript
  interface IClientApi {
  	getProductList(): Promise<IProductItem[]>;
  	getProductItem(id: string): Promise<IProductItem>;
  	processOrder(order: IOrderInfo): Promise<IOrederResponse>;
  }
  ```

## **2. Ключевые компоненты**

### **AppState - центральное состояние приложения**

Управляет всеми данными: товарами, корзиной, заказом и ошибками форм.

**Основные методы:**

- `setProducts()` - установка списка товаров
- `addToBasket()/removeFromBasket()` - управление корзиной
- `setOrderPart()` - обновление данных заказа
- `validateOrder()` - валидация формы заказа

### **Card - компонент карточки товара**

Универсальный компонент для отображения товара в каталоге, превью и корзине.

**Особенности:**

- Автоматическое определение категории товара
- Динамическое изменение кнопки "В корзину"/"Удалить"
- Поддержка разных типов отображения (column/center)

### **Basket - компонент корзины**

Отображает список товаров в корзине, общую сумму и кнопку оформления заказа.

### **Order & Contacts - формы заказа**

Двухэтапная форма оформления:

1. **Order** - способ оплаты и адрес
2. **Contacts** - email и телефон

### **Modal - модальное окно**

Универсальный компонент для отображения всплывающих окон.

### **Success - экран успешного заказа**

Отображается после успешного оформления заказа.

## **3. Система событий**

Приложение использует EventEmitter для коммуникации между компонентами:

**Основные события:**

- `preview:change` - изменение просматриваемого товара
- `basket:change` - изменение содержимого корзины
- `order:ready` - готовность заказа к отправке
- `formErrors:change` - изменение ошибок валидации
- `modal:open/close` - открытие/закрытие модального окна

## **4. Валидация форм**

**Правила валидации:**

- Email: стандартный формат email
- Телефон: `+7 (XXX) XXX-XX-XX`
- Адрес: минимум 5 символов
- Способ оплаты: обязательный выбор

## **5. API взаимодействие**

**ClientApi класс предоставляет методы:**

- `getProductList()` - получение списка товаров
- `getProductItem()` - получение конкретного товара
- `processOrder()` - отправка заказа на сервер

**Конфигурация API:**

```typescript
export const API_URL = `${process.env.API_ORIGIN}/api/weblarek`;
export const CDN_URL = `${process.env.API_ORIGIN}/content/weblarek`;
```

## **6. Утилиты**

**Key utilities:**

- `ensureElement()` - безопасное получение DOM-элемента
- `cloneTemplate()` - клонирование HTML-шаблонов
- `validateEmail()/validatePhone()` - валидация данных
- `bem()` - генерация BEM-классов

## **Структура директорий**

```
src/
├── components/          # React-компоненты
│   ├── base/           # Базовые компоненты
│   ├── common/         # Общие компоненты
│   └── api.ts          # API клиент
├── types/              # TypeScript определения
├── utils/              # Вспомогательные функции
│   ├── constants.ts    # Константы приложения
│   └── utils.ts        # Утилиты
├── scss/               # Стили проекта
└── index.ts            # Точка входа
```

## **Важные файлы:**

- `src/index.ts` - инициализация приложения
- `src/components/AppState.ts` - управление состоянием
- `src/utils/constants.ts` - конфигурация селекторов и настроек
- `src/types/index.ts` - определения типов TypeScript

## **Особенности реализации**

1. **Строгая типизация** - все компоненты и данные типизированы
2. **Event-driven архитектура** - компоненты общаются через события
3. **Шаблонный подход** - использование HTML templates для рендеринга
4. **Централизованное состояние** - AppState управляет всем состоянием приложения
5. **Валидация на стороне клиента** - комплексная проверка данных форм

Проект демонстрирует современный подход к разработке веб-приложений с использованием TypeScript и компонентной архитектуры.

``

## **1. Описание данных: интерфейсы и классы с хранением данных**

### **Интерфейсы:**

Определяют форму данных и методы, которыми эти данные управляются.

- **Товары**

  - `IProductItem`: представляет товар (id, title, image, description, category, price).

- **Корзина**

  - `IBasketItem`: элемент корзины (id, title, price).
  - `IBasketModel`: интерфейс корзины — методы для управления и коллекция `items`.

- **Заказ**

  - `IOrderInfo`: итоговые данные заказа — адрес, email, телефон, способ оплаты, список товаров, общая сумма.

- **API**

  - `IClientApi`: интерфейс клиентской части API для работы с товарами и заказами.
  - `IApiError`: структура ошибки от API.

- **Валидация**

  - `IValidatorSettings`: параметры валидации формы.
  - `IValidator`: интерфейс валидатора с методами `enableValidation()` и `clearValidation()`.

- **Типы карточек**

  - `CardViewType`: определяет тип визуального отображения карточки: `'catalog'`, `'preview'`, `'basket'`.

  - `CardItemType<T>`: определяет тип содержимого карточки в зависимости от её вида (`IProductItem` или `IBasketItem`).

  - `CardViewFactoryType<T>`: функция, генерирующая DOM-элемент карточки по шаблону и типу.

---

## **2. Модели данных: реализации интерфейсов, действия и назначение**

### **Классы:**

- **Basket (реализация `IBasketModel`)**

  - Хранит товары в `Map<string, IBasketItem>`.
  - Методы:
    - `addItem(item: IBasketItem)`: добавляет товар в корзину.
    - `removeItem(id: string)`: удаляет товар из корзины.
    - `clear()`: очищает корзину.
    - `getTotalPrice()`: рассчитывает сумму заказа.
  - Назначение: управляет состоянием корзины и предоставляет методы для её изменения.

- **ApiService (реализация `IClientApi`)**

  - Методы:
    - `getProductList()`: получает список товаров.
    - `getProductItem(id)`: получает один товар.
    - `processOrder(order)`: отправляет заказ.
  - Назначение: абстрагирует взаимодействие с сервером.

- **FormValidator (реализация `IValidator`)**

  - Использует `IValidatorSettings`.
  - Методы:
    - `enableValidation()`: навешивает слушатели событий.
    - `clearValidation(form)`: сбрасывает валидацию.
  - Назначение: управляет валидацией форм.

- **CardView <T extends CardViewType> (абстрактный класс)**

  - Универсальный класс отображения карточки.
  - Поля:
    - `element`: HTML-элемент карточки.
    - `prepareTemplate`: функция генерации шаблона (фабрика).
  - Конструктор принимает: шаблон, тип карточки, товар или элемент корзины, обработчик клика и события.
  - Используется для создания всех типов карточек.

---

## **3. Компоненты (визуальная часть)**

### **Карточки и списки товаров:**

- Все карточки наследуются от базового `CardView`:
  - `ProductView`: карточка товара в каталоге.
  - `DetailProductView`: подробная карточка товара.
  - `BasketItemView`: карточка элемента корзины.

> `CardView` автоматически связывает шаблон, тип карточки и данные, и возвращает готовый `HTMLElement`.

- `IMainPageView`: интерфейс главной страницы:
  - `productList`: список карточек.
  - `gallery`: блок с товарами.
  - `headerBasketButton`, `headerBasketCounter`: элементы шапки.
  - Методы: `renderProductList`, `fetchProductList`.

### **Корзина:**

- `IBasketItemView`: визуальное представление элемента корзины.
- `IBasketView`: интерфейс всей корзины с методами из `IBasketModel` + `onConfirm()` (подтверждение заказа).

### **Формы заказа:**

- `OrderInfoFormView`: шаг 1 — адрес и способ оплаты.
- `OrderInfoContactsFormView`: шаг 2 — email и телефон.
- Оба наследуются от абстрактного класса `Form<T>`:
  - Поля: `errors`- элемент с выводом ошибки формы, `submit`- кнопка отправки формы.
  - Методы: `render()`, `onInputChange()`.

### **Модальное окно:**

- `ModalView`: базовый класс модального окна.
  - Методы: `openModal()`, `closeModal()`, `render()`.
  - Поля: `element`, `closeButton`.

### **Финальный экран:**

- `ISuccessView`: объект с итоговой суммой после успешного оформления заказа (`total`).

---

## **4. Описание событий**

### **События, связанные с изменением данных (внутренние действия):**

- `addItem`: вызывается при добавлении товара в корзину.
- `removeItem`: удаляет товар из корзины.
- `clear`: очищает корзину после оформления заказа.
- `getTotalPrice`: пересчитывает общую сумму.
- `processOrder`: отправляет заказ на сервер.
- `getProductItem`, `getProductList`: получают данные товаров.

### **События – действия пользователя (UI события):**

- Клик по карточке товара (`ProductView.onClick`) → переход в подробный просмотр.
- Клик по "Добавить в корзину" (`DetailProductView`) → вызывает `IBasketModel.addItem`.
- Клик по "Удалить" в корзине (`BasketItemView`) → вызывает `IBasketModel.removeItem`.
- Клик по "Оформить заказ" → запускает цепочку `OrderInfoFormView → OrderInfoContactsFormView → processOrder`.
- Ввод данных в форме → вызывает `Form.onInputChange()` и запускает валидацию.
- Клик по кнопке подтверждения заказа → отправка данных и отображение `SuccessView`.

---

## Структура директорий

- `src/` — исходные файлы
- `src/components/` — содержит компоненты приложения
- `src/components/base/` — базовые компоненты
- `src/images/` — графические ресурсы проекта
- `src/pages/` — страницы приложения
- `src/public/` — статические ресурсы
- `src/scss/` — стили проекта
- `src/types/` — определения типов данных
- `src/utils/` — вспомогательные утилиты
- `src/vendor/` — сторонние библиотеки

## Важные файлы:

`- src/pages/index.html` — HTML-файл главной страницы
`- src/types/index.ts` — файл с типами
`- src/index.ts` — точка входа приложения
`- src/scss/styles.scss` — корневой файл стилей
`- src/utils/constants.ts` — файл с константами
`- src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```

npm install
npm run start

```

или

```

yarn
yarn start

```

```

```
